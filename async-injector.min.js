!function(a,b){"function"==typeof define&&define.amd?define(["bluebird"],b):"object"==typeof exports?module.exports=b(require("bluebird")):a.AsyncInjector=b(Promise)}(this,function(a){"use strict";var b=function(a){var b=/^function\s*[^\(]*\(\s*([^\)]*)\)/m,c=/,/,d=/((\/\/.*$)|(\/\*[\s\S]*?\*\/))/gm,e=a.toString().replace(d,"").match(b)[1];return""===e?[]:e.split(c).map(function(a){return a.trim()})},c=function(a,b){if(!a)throw new Error(b)},d=function(a,b,c){a.forEach(function(a){if(!b(a))throw new Error(c)})},e=function(a){Array.isArray(a)?(c("function"==typeof a[a.length-1],"Last element of array must be a function"),d(a.slice(0,a.length-1),function(a){return"string"==typeof a},"Dependency name must be a string")):"function"!=typeof a&&c(!1,"Injectable must be a function or an array")},f=function(a){return"function"==typeof a?a:a[a.length-1]},g=function(a){return"function"==typeof a?b(a):a.slice(0,a.length-1)},h=function(){this._factories={},this._cache={},this.log=function(a){console.log("[AsyncInjector] "+a)},this.info=function(a){console.info("[AsyncInjector] "+a)}};return h.prototype.config=function(a){var b=this;return Object.keys(a).forEach(function(c){b.value(c,a[c])}),this},h.prototype.value=function(a,b){return this.factory(a,function(){return b})},h.prototype.factory=function(a,b){return c("string"==typeof a,"Name should be a string"),e(b),c(!this._factories.hasOwnProperty(a),"Dependency "+a+" already defined."),this._factories[a]={factory:f(b),dependencies:g(b)},this},h.prototype.inject=function(a){var b=Date.now();e(a);var c=this;return c.log("Starting..."),this._inject(g(a),f(a)).then(function(a){return c.log("Started in "+(Date.now()-b)+"ms"),a})},h.prototype._inject=function(b,d){var e=this;return a.all(b.map(function(a){return c(e._factories.hasOwnProperty(a),"Dependency "+a+" does not exists."),e._cache.hasOwnProperty(a)||(e._cache[a]=e._inject(e._factories[a].dependencies,e._factories[a].factory)),e.info("Loading "+a),e._factories[a].startTime=Date.now(),e._cache[a].then(function(b){return e._factories[a].endTime||(e._factories[a].endTime=Date.now(),e.info("Loaded "+a+" in "+(e._factories[a].endTime-e._factories[a].startTime)+"ms")),b})})).spread(d)},h});